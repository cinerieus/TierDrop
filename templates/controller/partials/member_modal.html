<div class="modal-backdrop" onclick="if(event.target===this)this.remove()">
    <div class="modal">
        <div class="modal-header">
            <h3>Member {{ member.display_id() }}</h3>
            <button class="modal-close" onclick="this.closest('.modal-backdrop').remove()">&times;</button>
        </div>
        <form {% if can_modify %}hx-post="/controller/{{ nwid }}/members/{{ member.display_id() }}/update"
              hx-swap="none"{% endif %}>
            <div class="modal-body" {% if !can_modify %}style="opacity: 0.6;"{% endif %}>
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" name="name" class="form-input"
                           value="{{ name }}" placeholder="Display name" {% if !can_modify %}disabled{% endif %}>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="authorized" value="on"
                               {% if member.is_authorized() %}checked{% endif %} {% if !can_modify %}disabled{% endif %}>
                        Authorized
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="active_bridge" value="on"
                               {% if member.is_bridge() %}checked{% endif %} {% if !can_modify %}disabled{% endif %}>
                        Allow Ethernet Bridging
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" name="no_auto_assign_ips" value="on"
                               {% if member.no_auto_assign_ips %}checked{% endif %} {% if !can_modify %}disabled{% endif %}>
                        Do Not Auto-Assign IPs
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">IP Assignments</label>
                    <input type="text" name="ip_assignments" class="form-input mono"
                           value="{{ member.display_ip_assignments() }}"
                           placeholder="e.g. 10.0.0.1, fd00::1" {% if !can_modify %}disabled{% endif %}>
                    <small class="text-secondary">Comma-separated (IPv4 and IPv6)</small>
                </div>

                {% match rfc4193_addr %}
                {% when Some with (addr) %}
                <div class="form-group">
                    <label class="form-label">RFC4193 Address</label>
                    <div class="mono text-secondary" style="padding:6px 0;">{{ addr }}</div>
                </div>
                {% when None %}
                {% endmatch %}

                {% match sixplane_addr %}
                {% when Some with (addr) %}
                <div class="form-group">
                    <label class="form-label">6PLANE Address</label>
                    <div class="mono text-secondary" style="padding:6px 0;">{{ addr }}</div>
                </div>
                {% when None %}
                {% endmatch %}

                <div class="modal-section">
                    <div class="modal-section-title">Details</div>
                    <div class="info-grid">
                        <div class="text-secondary">Version</div>
                        <div class="mono">{{ member.display_version() }}</div>
                        <div class="text-secondary">Created</div>
                        <div>{{ member.display_creation_time() }}</div>
                        <div class="text-secondary">Last Authorized</div>
                        <div>{{ member.display_last_authorized() }}</div>
                        <div class="text-secondary">Last Deauthorized</div>
                        <div>{{ member.display_last_deauthorized() }}</div>
                        <div class="text-secondary">Identity</div>
                        <div class="mono" style="word-break:break-all;font-size:0.75rem">
                            {% match member.identity.as_deref() %}
                            {% when Some with (id) %}{{ id }}{% when None %}-{% endmatch %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-sm"
                        onclick="this.closest('.modal-backdrop').remove()">{% if can_modify %}Cancel{% else %}Close{% endif %}</button>
                {% if can_modify %}
                <button type="submit" class="btn btn-primary btn-sm"><span class="htmx-hide-on-request">Save</span><span class="spinner htmx-indicator"></span></button>
                {% endif %}
            </div>
        </form>
    </div>
</div>
<script>
document.body.addEventListener("member-updated", function() {
    var bd = document.querySelector(".modal-backdrop");
    if (bd) bd.remove();
}, {once: true});
</script>
